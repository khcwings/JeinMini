"use strict";var JeinGridFactory={getDefaultOptions:function(){return{el:null,data:[],scrollX:!1,scrollY:!1,header:[],columns:[]}}};function JeinGrid(){var e=null;this.getGrid=function(){return e},this.setGrid=function(t){e=t},this.prevRowIndex=null,this.prevColumnName=null}function JeinComboBox(){this.labelKey,this.valueKey,this.defaultShow=!1,this.defaultValue="",this.defaultLabel="선택"}JeinGrid.prototype.create=function(t){var e={};return jut.isEmpty(t.id)||(e.el=$("#"+t.id.replace(/\#/g,""))),jut.isEmpty(t.rowHeaders)||(e.rowHeaders=t.rowHeaders),jut.isEmpty(t.scrollX)||(e.scrollX=t.scrollX),jut.isEmpty(t.scrollY)||(e.scrollY=t.scrollY),jut.isEmpty(t.header)||(e.header=t.header),jut.isEmpty(t.pagination)||(e.pagination=t.pagination),jut.isEmpty(t.columns)||(e.columns=t.columns),jut.isEmpty(t.height)||(e.bodyHeight=t.height),jut.isEmpty(t.virtualScrolling)||(e.virtualScrolling=t.virtualScrolling),jut.isEmpty(t.treeOptions)||(e.treeColumnOptions=t.treeOptions),this.setGrid(new tui.Grid(e)),"object"!=typeof t.data||jut.isEmpty(t.data.length)||this.getGrid().setData(t.data),jut.isEmpty(t.focusDefault)||t.focusDefault||this.getGrid().on("mousedown",function(t){"columnHead"===t.targetType&&t.stop()}),this},JeinGrid.prototype.addColumns=function(t){var e=this.getGrid();if(!jut.isEmpty(e)){var i=e.getColumns().concat(t);e.setColumns(i)}return this},JeinGrid.prototype.setGridStyle=function(t){tui.Grid.applyTheme("default",t)},JeinGrid.prototype.setData=function(t){return this.getGrid().setData(t),this},JeinGrid.prototype.setAjaxData=function(i){var n=this;return jcm.doAjax(!0,i.url,i.requestData,function(t,e){jut.isEmpty(i.dataKey)?n.setData(t):n.setData(t[i.dataKey])}),this},JeinGrid.prototype.setTreeData=function(t,e){var i,n=t,a=e.sortKey,o=e.parentKey,r=e.childrenKey,s=!jut.isEmpty(e.expand)&&e.expand,l=jut.ascendingSort(n,a),u={};u[o]="";var d=function(t){var e=t[o];t._children=[];for(var i=0;i<l.length;i++)l[i][r]===e&&(l[i]=d(l[i]),s&&(l[i]._extraData={treeState:"EXPAND"}),t._children.push(l[i]));return t._children=jut.ascendingSort(t._children,a),t};i=d(u);for(var h=[],c=0;c<i._children.length;c++)h.push(i._children[c]);return this.setData(h),this},JeinGrid.prototype.setAjaxTreeData=function(i){var n=this;return jcm.doAjax(!0,i.url,i.requestData,function(t,e){jut.isEmpty(i.dataKey)?n.setTreeData(t,i):n.setTreeData(t[i.dataKey],i)}),this},JeinGrid.prototype.focusChangeRow=function(e){var i=this;return this.getGrid().on("focusChange",function(t){i.prevRowIndex!==t.rowKey&&(e(t.rowKey,t.columnName,t.prevRowKey,t.prevColumnName),i.prevRowIndex=t.rowKey,i.prevColumnName=t.columnName)}),this},JeinGrid.prototype.focusChangeCell=function(e){return this.getGrid().on("focusChange",function(t){e(t.rowKey,t.columnName,t.prevRowKey,t.prevColumnName)}),this},JeinGrid.prototype.addRow=function(t,e){var i={},n=this.getGrid().getColumns();if(jut.isEmpty(e))for(var a=0;a<n.length;a++)i[n[a].name]="";else for(a=0;a<n.length;a++)for(var o in e)o===n[a].name?i[n[a].name]=e[o]:i[n[a].name]="";return this.getGrid().appendRow(i,{at:t}),this},JeinGrid.prototype.setRowDisabled=function(i){var n=this;return this.getGrid().on("mousedown",function(t){t.nativeEvent.target;var e=t.rowKey;n.getCellData(e,i.name)===i.value&&n.getGrid().disableRow(e)}),this},JeinGrid.prototype.setCellData=function(t,e,i){return this.getGrid().setValue(t,e,i),this},JeinGrid.prototype.setCheckedRowCellData=function(t,e){for(var i=this.getGrid(),n=i.getCheckedRowKeys(!1),a=0;a<n.length;a++)i.setValue(n[a],t,e);return this},JeinGrid.prototype.getCellData=function(t,e){return this.getGrid().getValue(t,e,!1)},JeinGrid.prototype.getFocusedCellData=function(t){var e=this.getGrid().getFocusedCell();return this.getGrid().getValue(e,t,!1)},JeinGrid.prototype.getData=function(){return this.getGrid().getRows()},JeinGrid.prototype.getChangedIgnoreData=function(t){var e=[];jut.isEmpty(t)||jut.isEmpty(t.length)||(e=t);for(var i=this.getGrid().getModifiedRows({checkedOnly:!1,withRawData:!1,rowKeyOnly:!1,ignoredColumns:e}),n=i.createdRows,a=i.updatedRows,o=i.deletedRows,r=[],s=0;s<n.length;s++)n[s].ROW_STATUS="C",r.push(n[s]);for(s=0;s<a.length;s++)a[s].ROW_STATUS="U",r.push(a[s]);for(s=0;s<o.length;s++)o[s].ROW_STATUS="D",r.push(o[s]);return r},JeinGrid.prototype.removeCheckedRows=function(){this.getGrid().removeCheckedRows(!1)},JeinGrid.prototype.getCheckedRowIndex=function(){},JeinComboBox.prototype.draw=function(t,e){var i,n=document.getElementById(e);n.innerHtml="",this.defaultShow&&((i=document.createElement("option")).value=this.defaultValue,i.innerText=this.defaultLabel,n.appendChild(i));for(var a=0;a<t.length;a++)(i=document.createElement("option")).value=t[a][this.valueKey],i.innerText=t[a][this.labelKey],n.appendChild(i);return this},JeinComboBox.prototype.create=function(i){var n=this;return jut.isEmpty(i.labelKey),this.labelKey=i.labelKey,this.valueKey=i.valueKey,jut.isEmpty(i.defaultShow)||(this.defaultShow=i.defaultShow),jut.isEmpty(i.defaultValue)||(this.defaultValue=i.defaultValue),jut.isEmpty(i.defaultLabel)||(this.defaultLabel=i.defaultLabel),jut.isEmpty(i.data)?jcm.doAjax(!0,i.url,i.requestData,function(t,e){"S"===t.resultCode&&n.draw(t[i.dataKey],i.id)}):this.draw(i.data,i.id),this};var JeinModalFactory=function(){var n=[];return{addModal:function(t,e){n.push({id:e,modal:t})},removeModal:function(t){for(var e=0;e<n.length;e++)n[e].id===t&&n.slice(e,e+1)},getModal:function(t){for(var e=null,i=0;i<n.length;i++)n[i].id===t&&(e=n[i].modal);return e}}}();function JeinModal(t){var e=null;jut.isEmpty(t.data)||t.data;if(this.isShow=!1,this.id=jut.isEmpty(t.id)?"":t.id,this.url=jut.isEmpty(t.url)?"":t.url,this.width=jut.isEmpty(t.width)?jcm.constant.popup_width:1*t.width,this.height=jut.isEmpty(t.height)?jcm.constant.popup_height:1*t.height,this.bodyHeight=this.height,this.target=jut.isEmpty(t.target)?null:t.target,this.header=!jut.isEmpty(t.header)&&t.header,this.title=jut.isEmpty(t.title)?"":t.title,this.footer=!jut.isEmpty(t.header)&&t.header,this.okBtnFlag=!jut.isEmpty(t.okButton),this.cancelBtnFlag=!jut.isEmpty(t.cancelButton),this.okBtn=jut.isEmpty(t.okButton)?null:t.okButton,this.cancelBtn=jut.isEmpty(t.cancelButton)?null:t.cancelButton,this.customBtn=jut.isEmpty(t.customButtons)?null:t.customButtons,this.getData=function(){return this.data},this.getModal=function(){return e},jut.isEmpty(this.id))alert("팝업 ID가 없습니다.");else if(jut.isEmpty(this.url))alert("팝업 URL이 없습니다.");else if(jut.isEmpty(this.target))alert("이벤트를 동작시킬 버튼ID가 없습니다.");else{this.header&&(this.height+=50),this.footer&&(this.height+=50);var i=this;this.url=jcm.contentPath+this.url,JeinModalFactory.removeModal(this.id),$("#"+i.id).remove();var n=document.createElement("div");n.id=this.id,n.className="dim-layer";var a=document.createElement("div");a.className="dimBg",a.addEventListener("click",function(t){t.stopPropagation(),i.hide()}),n.appendChild(a);var o=document.createElement("div");o.className="pop-layer",o.style.width=this.width+"px",o.style.height=this.height+"px";var r=document.createElement("div");r.className="pop-header",r.style.height="50px",r.innerText=jut.isEmpty(this.title)?"":this.title;var s=document.createElement("div");s.className="pop-body",s.style.height=this.bodyHeight+"px";var l=document.createElement("div");if(l.className="pop-footer",l.style.height="50px",this.okBtnFlag){var u=document.createElement("button");u.innerText=jut.isEmpty(this.okBtn.label)?"Ok":this.okBtn.label,u.className=jut.isEmpty(this.okBtn.className)?"ui-button ui-corner-all ui-widget":this.okBtn.className,u.addEventListener("click",function(t){jut.isEmpty(i.okBtn.callback)||i.okBtn.callback(i)}),l.appendChild(u)}if(this.cancelBtnFlag){var d=document.createElement("button");d.innerText=jut.isEmpty(this.cancelBtn.label)?"Cancel":this.cancelBtn.label,d.className=jut.isEmpty(this.cancelBtn.className)?"ui-button ui-corner-all ui-widget":this.cancelBtn.className,d.addEventListener("click",function(t){jut.isEmpty(i.cancelBtn.callback)||i.cancelBtn.callback(i)}),l.appendChild(d)}if(!jut.isEmpty(this.customBtn)&&!jut.isEmpty(this.customBtn.length))for(var h=0;h<this.customBtn.length;h++){var c=document.createElement("button");c.innerText=jut.isEmpty(this.customBtn[h].label)?"":this.customBtn[h].label,c.className=jut.isEmpty(this.customBtn[h].className)?"ui-button ui-corner-all ui-widget":this.customBtn[h].className,c.setAttribute("data-index",h),c.addEventListener("click",function(t){jut.isEmpty(i.customBtn[1*t.target.getAttribute("data-index")].callback)||i.customBtn[1*t.target.getAttribute("data-index")].callback(i)}),l.appendChild(c)}o.appendChild(r),o.appendChild(s),o.appendChild(l),n.appendChild(o),e=$(n),JeinModalFactory.addModal(this,this.id),$("#"+i.target).on("click",function(){i.show()})}}JeinModal.prototype.show=function(){if(console.log("show"),!this.isShow){var o=this;$("body",top.document).append(o.getModal()),$("#"+o.id+" .pop-body").load(o.url,{},function(t,e,i){if("success"===e){var n=$("#"+o.id+" .pop-layer").outerWidth(),a=$("#"+o.id+" .pop-layer").outerHeight();$("#"+o.id+" .pop-layer").css({marginTop:a/2*-1,marginLeft:n/2*-1,position:"absolute"}),$("#"+o.id).show(jcm.constant.popup_effect,{},jcm.constant.popup_effect_time,function(){}),o.isShow=!0}})}return this},JeinModal.prototype.hide=function(){if(this.isShow){var t=this;$("#"+t.id).hide(jcm.constant.popup_effect,{},jcm.constant.popup_effect_time,function(){$("#"+t.id).remove(),t.isShow=!1})}return this},JeinModal.prototype.then=function(t){return t(JeinModalFactory.getModal(this.id)),this},JeinModal.prototype.isShow=function(){return this.isShow},JeinModal.prototype.broadcast=function(t){return JeinModalFactory.getModal(t).getData()};